**فصل ۷: استقرار (Deploy)، نگه داری و امنیت ربات**  

---

### **۷.۱ آماده سازی ربات برای استقرار**  
قبل از آپلود ربات روی سرور، باید مطمئن شوید:  
1. **پنهان کردن توکن و اطلاعات حساس**:  
   - از پکیج `dotenv` برای استفاده از فایل `.env` استفاده کنید.  
   - فایل `.env`:  
     ```env
     TOKEN=مقدار_توکن_شما
     PREFIX=!
     ```
   - در کد:  
     ```javascript
     require('dotenv').config();
     client.login(process.env.TOKEN);
     ```

2. **حذف فایل های غیرضروری**:  
   - فایل `node_modules` را با دستور `npm install --production` دوباره نصب کنید.  
   - فایل های تست و لوکال (`database.json` یا ...) را بررسی کنید.  

---

### **۷.۲ استقرار روی سرور های ابری (رایگان)**  
#### **روش ۱: استفاده از Replit**  
- مناسب برای شروع و پروژه های کوچک.  
1. پروژه جدید در [Replit](https://replit.com) بسازید.  
2. کدها را آپلود کنید و فایل `.env` را در **Secrets** قرار دهید.  
3. از **Always On** استفاده کنید تا ربات ۲۴/۷ فعال بماند.  

#### **روش ۲: استفاده از Railway یا Heroku**  
- **Railway** (رایگان با محدودیت):  
  1. پروژه را به GitHub متصل کنید.  
  2. متغیر های محیطی (Environment Variables) را در تنظیمات اضافه کنید.  
  3. دامنه رایگان Railway را استفاده کنید.  

---

### **۷.۳ استقرار روی سرور اختصاصی (VPS)**  
#### **مراحل پایه برای لینوکس (Ubuntu)**:  
1. **اتصال به سرور**:  
   ```bash
   ssh root@IP_سرور
   ```

2. **نصب Node.js و npm**:  
   ```bash
   curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
   sudo apt-get install -y nodejs
   ```

3. **کپی کردن فایل های پروژه**:  

   ```bash
   git clone https://github.com/نام-کاربری/ربات-شما.git
   cd ربات-شما
   npm install
   ```

4. **اجرای ربات با PM2 (برای اجرای دائمی)**:  
   ```bash
   sudo npm install -g pm2
   pm2 start index.js --name "my-bot"
   pm2 save
   pm2 startup
   ```

---

### **۷.۴ امنیت ربات**  
1. **محدود کردن دسترسی ها**:  
   - در پنل توسعه دهندگان دیسکورد، فقط **Intents** لازم را فعال کنید.  
   - از دسترسی های ربات (**Bot Permissions**) به صورت دقیق استفاده کنید (مثلاً فقط `Send Messages` و `Read Message History`).  

2. **جلوگیری از حمله DDoS یا اسپم**:  
   - محدودیت نرخ (Rate Limiting) با پکیج `express-rate-limit`.  
   - بررسی کد برای حلقه های بینهایت.  

3. **بکاپ گیری منظم**:  
   - از دیتابیس و فایل های مهم به صورت خودکار بکاپ بگیرید (مثلاً با Cron Jobs).  

---

### **۷.۵ نگه داری و بهینهسازی**  
1. **مانیتورینگ منابع**:  
   - با `pm2 list` وضعیت ربات را بررسی کنید.  
   - از `pm2 logs` برای مشاهده لاگ ها استفاده کنید.  

2. **بروزرسانی پکیج ها**:  
   ```bash
   npm outdated  # بررسی پکیج های قدیمی
   npm update    # بروزرسانی
   ```

3. **مدیریت خطا های غیرمنتظره**:  
   - از `process.on('uncaughtException')` برای جلوگیری از کرش استفاده کنید:  
     ```javascript
     process.on('uncaughtException', (error) => {
       console.error('خطای کشف نشده:', error);
     });
     ```

---

### **تمرین عملی فصل ۷**  
۱. ربات خود را روی Replit یا Railway مستقر کنید و مطمئن شوید ۲۴/۷ فعال است.  
۲. با PM2 ربات را روی یک سرور لینوکس (حتی لوکال) اجرا کنید.  
۳. یک سیستم بکاپ گیری ساده با Cron Job برای دیتابیس بسازید.  

---

### **مشکلات رایج**  
- **ربات بعد از مدتی قطع می شود**:  
  - از PM2 یا Docker برای اجرای دائمی استفاده کنید.  
  - منابع سرور (CPU/RAM) را بررسی کنید.  
- **خطای `Missing Permissions`**:  
  - دسترسی های ربات را در [پنل دیسکورد](https://discord.com/developers/applications) بررسی کنید.  

---

### **نکات طلایی**  
- برای پروژه های بزرگ، از **Docker** استفاده کنید تا محیط اجرا یکسان بماند.  
- همیشه **ورژن های اصلی** (Major Versions) کتابخانه ها را بررسی کنید (مثلاً تغییرات discord.js v13 به v14).  
- در صورت امکان، از **Webhooks** برای دریافت نوتیفیکیشن خطا ها استفاده کنید.  

--- 

با پایان این فصل، شما توانایی ساخت، استقرار و نگه داری یک ربات حرفه ای دیسکورد را دارید! 🎉  
**[پیشنهاد]** در فصل بعدی، چند پروژه عملی برای تثبیت مهارت ها انجام خواهیم داد!