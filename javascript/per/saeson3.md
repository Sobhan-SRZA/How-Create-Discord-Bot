**فصل ۳: آشنایی با Node.js و npm**  

---

### **۳.۱ Node.js چیست؟**  
Node.js یک **محیط اجرایی** (Runtime Environment) برای زبان جاوا اسکریپت است که به شما اجازه می دهد کدهای جاوا اسکریپت را **خارج از مرورگر** (مثلاً روی سرور یا کامپیوتر شخصی) اجرا کنید.  

#### **چرا Node.js برای ربات های دیسکورد مناسب است؟**  
- **غیرمسدودکننده (Non-Blocking)**:  
  Node.js کدها را به صورت ناهمزمان (Asynchronous) اجرا می کند، یعنی اگر یک عملیات زمانبر (مثل خواندن فایل) انجام شود، بقیه کدها منتظر نمی مانند و اجرا می شوند.  

  ```javascript
  // مثال: خواندن فایل بدون مسدود کردن سایر کدها
  const fs = require('fs');
  fs.readFile('file.txt', 'utf8', (err, data) => {
    console.log(data); // پس از خواندن فایل اجرا می شود
  });
  console.log('این خط اول اجرا می شود!');
  ```
  
- **رویدادمحور (Event-Driven)**:  
  Node.js بر پایه رویداد ها کار می کند. مثلاً وقتی کاربری در دیسکورد پیامی ارسال می کند، یک رویداد (`messageCreate`) رخ می دهد و کد شما به آن واکنش نشان می دهد.  

---

### **۳.۲ مدیریت پکیج ها با npm**  
**npm** (مخفف Node Package Manager) یک ابزار برای نصب، مدیریت و اشتراک گذاری پکیج های جاوا اسکریپت است. هر پکیج یک کتابخانه یا ابزار آماده است (مثل `discord.js`).  

#### **کاربرد های اصلی npm**  
1. **نصب پکیج ها**:  
   ```bash
   npm install discord.js
   ```
2. **حذف پکیج ها**:  
   ```bash
   npm uninstall discord.js
   ```
3. **بروزرسانی پکیج ها**:  
   ```bash
   npm update discord.js
   ```

---

### **۳.۳ فایل `package.json`**  
این فایل قلب پروژه های Node.js است و شامل اطلاعات پروژه و لیست **وابستگی ها** (Dependencies) می شود.  

#### **ساخت `package.json`**  
- دستور زیر یک فایل `package.json` جدید میسازد:  
  ```bash
  npm init -y
  ```
- محتوای نمونه:  
  ```json
  {
    "name": "my-bot",
    "version": "1.0.0",
    "main": "index.js",
    "scripts": {
      "start": "node index.js"
    },
    "dependencies": {
      "discord.js": "^14.13.0"
    }
  }
  ```

#### **نکات مهم**  
- **ورژن پکیج ها (`^` و `~`)**:  
  - `^14.13.0`: اجازه بروزرسانی به ورژن های **جزئی** جدیدتر را می دهد (مثلاً ۱۴.۱۴.۰).  
  - `~14.13.0`: فقط اجازه بروزرسانی به ورژن های **پچ** را می دهد (مثلاً ۱۴.۱۳.۱).  

---

### **۳.۴ نصب پکیج ها به صورت Global vs Local**  
- **نصب Local (پیشفرض)**:  
  پکیج فقط در پروژه فعلی قابل استفاده است.  
  ```bash
  npm install discord.js
  ```
- **نصب Global**:  
  پکیج در کل سیستم نصب می شود (برای ابزار های CLI مناسب است).  
  ```bash
  npm install -g nodemon
  ```

---

### **۳.۵ اجرای پروژه با npm Scripts**  
از فایل `package.json` می توانید برای تعریف دستورات سریع استفاده کنید:  
```json
"scripts": {
  "start": "node index.js",
  "dev": "nodemon index.js"
}
```
- اجرای اسکریپت ها:  
  ```bash
  npm run dev
  ```

---

### **تمرین عملی فصل ۳**  
۱. یک پوشه جدید بسازید و با `npm init -y` فایل `package.json` ایجاد کنید.  
۲. پکیج `chalk` را نصب کنید تا متن های رنگی در کنسول چاپ کنید.  
۳. فایل `index.js` بسازید و کد زیر را در آن بنویسید:  

   ```javascript
   const chalk = require('chalk');
   console.log(chalk.green('سلام دنیا!'));
   ```
۴. پروژه را با دستور `node index.js` اجرا کنید.  

---

### **مشکلات رایج و راه حل ها**  
- **خطای `npm install`**:  
  - اتصال اینترنت را بررسی کنید.  
  - از دستور `npm cache clean --force` استفاده کنید.  
- **خطای دسترسی (Permission Denied)**:  
  - برای نصب Global از `sudo` (در مک/لینوکس) یا PowerShell با حقوق Administrator (در ویندوز) استفاده کنید.  

---

### **نکات کلیدی**  
- همیشه پکیج های اصلی پروژه (مثل `discord.js`) را با `npm install` نصب کنید، نه به صورت Global.  
- فایل `node_modules` را در `.gitignore` قرار دهید (چون حجم بالایی دارد).  
- برای به روز رسانی Node.js، از [وبسایت رسمی](https://nodejs.org) نسخه جدیدتر دانلود کنید.  

---

در فصل بعدی، **شروع کار با کتابخانه discord.js** را یاد خواهید گرفت و اولین ربات خود را توسعه می دهید! 🚀