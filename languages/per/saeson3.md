**فصل ۳: آشنایی با Node.js و npm**  
---

### **۳.۱ Node.js چیست؟**  
Node.js یک **محیط اجرایی** (Runtime Environment) برای زبان جاوااسکریپت است که به شما اجازه میدهد کدهای جاوااسکریپت را **خارج از مرورگر** (مثلاً روی سرور یا کامپیوتر شخصی) اجرا کنید.  

#### **چرا Node.js برای رباتهای دیسکورد مناسب است؟**  
- **غیرمسدودکننده (Non-Blocking)**:  
  Node.js کدها را بهصورت ناهمزمان (Asynchronous) اجرا میکند، یعنی اگر یک عملیات زمانبر (مثل خواندن فایل) انجام شود، بقیه کدها منتظر نمیمانند و اجرا میشوند.  
  ```javascript
  // مثال: خواندن فایل بدون مسدود کردن سایر کدها
  const fs = require('fs');
  fs.readFile('file.txt', 'utf8', (err, data) => {
    console.log(data); // پس از خواندن فایل اجرا میشود
  });
  console.log('این خط اول اجرا میشود!');
  ```
  
- **رویدادمحور (Event-Driven)**:  
  Node.js بر پایه رویدادها کار میکند. مثلاً وقتی کاربری در دیسکورد پیامی ارسال میکند، یک رویداد (`messageCreate`) رخ میدهد و کد شما به آن واکنش نشان میدهد.  

---

### **۳.۲ مدیریت پکیجها با npm**  
**npm** (مخفف Node Package Manager) یک ابزار برای نصب، مدیریت و اشتراکگذاری پکیجهای جاوااسکریپت است. هر پکیج یک کتابخانه یا ابزار آماده است (مثل `discord.js`).  

#### **کاربردهای اصلی npm**  
1. **نصب پکیجها**:  
   ```bash
   npm install discord.js
   ```
2. **حذف پکیجها**:  
   ```bash
   npm uninstall discord.js
   ```
3. **بروزرسانی پکیجها**:  
   ```bash
   npm update discord.js
   ```

---

### **۳.۳ فایل `package.json`**  
این فایل قلب پروژههای Node.js است و شامل اطلاعات پروژه و لیست **وابستگیها** (Dependencies) میشود.  

#### **ساخت `package.json`**  
- دستور زیر یک فایل `package.json` جدید میسازد:  
  ```bash
  npm init -y
  ```
- محتوای نمونه:  
  ```json
  {
    "name": "my-bot",
    "version": "1.0.0",
    "main": "index.js",
    "scripts": {
      "start": "node index.js"
    },
    "dependencies": {
      "discord.js": "^14.13.0"
    }
  }
  ```

#### **نکات مهم**  
- **ورژن پکیجها (`^` و `~`)**:  
  - `^14.13.0`: اجازه بروزرسانی به ورژنهای **جزئی** جدیدتر را میدهد (مثلاً ۱۴.۱۴.۰).  
  - `~14.13.0`: فقط اجازه بروزرسانی به ورژنهای **پچ** را میدهد (مثلاً ۱۴.۱۳.۱).  

---

### **۳.۴ نصب پکیجها بهصورت Global vs Local**  
- **نصب Local (پیشفرض)**:  
  پکیج فقط در پروژه فعلی قابل استفاده است.  
  ```bash
  npm install discord.js
  ```
- **نصب Global**:  
  پکیج در کل سیستم نصب میشود (برای ابزارهای CLI مناسب است).  
  ```bash
  npm install -g nodemon
  ```

---

### **۳.۵ اجرای پروژه با npm Scripts**  
از فایل `package.json` میتوانید برای تعریف دستورات سریع استفاده کنید:  
```json
"scripts": {
  "start": "node index.js",
  "dev": "nodemon index.js"
}
```
- اجرای اسکریپتها:  
  ```bash
  npm run dev
  ```

---

### **تمرین عملی فصل ۳**  
۱. یک پوشه جدید بسازید و با `npm init -y` فایل `package.json` ایجاد کنید.  
۲. پکیج `chalk` را نصب کنید تا متنهای رنگی در کنسول چاپ کنید.  
۳. فایل `index.js` بسازید و کد زیر را در آن بنویسید:  
   ```javascript
   const chalk = require('chalk');
   console.log(chalk.green('سلام دنیا!'));
   ```
۴. پروژه را با دستور `node index.js` اجرا کنید.  

---

### **مشکلات رایج و راهحلها**  
- **خطای `npm install`**:  
  - اتصال اینترنت را بررسی کنید.  
  - از دستور `npm cache clean --force` استفاده کنید.  
- **خطای دسترسی (Permission Denied)**:  
  - برای نصب Global از `sudo` (در مک/لینوکس) یا PowerShell با حقوق Administrator (در ویندوز) استفاده کنید.  

---

### **نکات کلیدی**  
- همیشه پکیجهای اصلی پروژه (مثل `discord.js`) را با `npm install` نصب کنید، نه بهصورت Global.  
- فایل `node_modules` را در `.gitignore` قرار دهید (چون حجم بالایی دارد).  
- برای بهروزرسانی Node.js، از [وبسایت رسمی](https://nodejs.org) نسخه جدیدتر دانلود کنید.  

---

در فصل بعدی، **شروع کار با کتابخانه discord.js** را یاد خواهید گرفت و اولین ربات خود را توسعه میدهید! 🚀